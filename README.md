## Web3 기반 분산형 GPU 컴퓨팅 플랫폼 개발 계획

### 1. 프로젝트 개요 및 목표

본 프로젝트는 RunPod의 GPU 컴퓨팅 서비스 모델을 차용하여, Web3 기술(토크노믹스 및 블록체인 결제)을 통합하고 네트워킹 구조를 경량화함으로써 투명하고 효율적인 분산형 GPU 컴퓨팅 플랫폼을 구축하는 것을 목표로 합니다. 특히, 기존 Kubernetes의 복잡한 네트워킹 계층을 제거하고 WebRTC 및 SSH 기반의 파일 전송 기능을 강화하여 사용자 경험(UX)과 효율성을 극대화합니다.

---

### 2. 주요 기능 및 개발 목표

|**영역**|**주요 기능 (Key Features)**|**개발 목표**|
|---|---|---|
|**I. 데이터 전송**|**WebRTC P2P 파일 전송**|브라우저 기반의 대기 시간이 짧은 **P2P 파일 전송 채널** 구현.|
||**SSH 기반 안전 전송**|`runpodctl send` 유사 기능을 구현하여 **스크립트 기반 대용량 파일 전송** 지원.|
|**II. 인프라 관리**|**Kube 네트워킹 간소화**|Kube의 **Service 및 Ingress** 계층을 생략하고 Pod에 **직접 접근 URL** 자동 생성.|
||**자동 접근 제공**|Pod 실행 시 **SSH 접속 정보**와 **Web Proxy URL**을 자동으로 제공.|
|**III. 토크노믹스**|**초 단위 실시간 정산**|시작/중지 이벤트를 감지하는 **자체 모니터링 에이전트**를 통한 사용량 측정.|
||**온체인 결제 게이트웨이**|Off-Chain 사용량 데이터를 **스마트 컨트랙트 트랜잭션**으로 자동 변환 및 제출.|
|**IV. 보안/운영**|**핫 월렛 관리**|자동 트랜잭션을 위한 백엔드 지갑의 **최소 잔액 유지 및 보안 관리** 시스템 구축.|

---

### 3. 요소별 개발 과정 상세 설명

#### A. 데이터 전송 시스템 개발

| **기능**               | **상세 개발 과정**                                                                                                                                                                                                                                                                                          | **참고 코드 분석**                                            |
| -------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------- |
| **WebRTC P2P 파일 전송** | 1. **시그널링 서버 구축:** Node.js 기반의 WebSocket 서버를 구축하여 SDP(Session Description Protocol) 및 ICE Candidate 교환을 처리합니다. 2. **클라이언트 측 로직:** JavaScript의 `RTCPeerConnection`과 `RTCDataChannel`을 사용하여 브라우저 간 직접 통신 채널을 열고, 파일을 조각내어 전송 및 수신 측에서 재조립하는 로직을 구현합니다.                                                  | -                                                       |
| **SSH 기반 파일 전송**     | 1. **Pod SSH 서버 구성:** Worker Pod Template(예: `worker-comfyui` 이미지 기반)에 **SSH 서버**(`sshd`)가 기본적으로 구동되도록 설정하고, 시작 시 사용자 키를 주입하는 스크립트를 포함합니다. 2. **CLI 도구 개발:** `runpodctl` 프로젝트를 분석하여, 해당 CLI의 **`send` 명령어 구조**와 **SCP/SFTP 라이브러리**를 활용하는 방식을 파악합니다. 이를 기반으로 사용자 로컬 환경과 원격 Pod 간의 안전한 파일 복사 기능을 구현합니다. | **`runpod/runpodctl`** 분석: SSH/SCP를 활용한 원격 파일 전송 로직 파악. |

#### B. GPU Pod 오케스트레이션 및 접근성 개선

| **기능**            | **상세 개발 과정**                                                                                                                                                                                                                                                                   | **참고 코드 분석**                                                                                    |
| ----------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ----------------------------------------------------------------------------------------------- |
| **Kube 네트워킹 간소화** | 1. **Kube API 직접 제어:** Kube API 서버와 직접 통신하는 **커스텀 컨트롤러** 또는 **API 게이트웨이**를 개발합니다. 2. **Service/Ingress 대체:** Pod 생성 요청 시, Kube 네트워킹 오브젝트 대신 **Reverse Proxy 설정**을 생성하고, Pod의 내부 IP를 이 Proxy에 연결하여 외부에서 직접 접근 가능한 URL(`https://[pod-id].proxy.domain.com`)을 즉시 생성하도록 로직을 구현합니다. | **`runpod` 시스템 분석:** Kube의 Service/Ingress를 대체하는 **프록시 관리 로직** 및 **자동 URL 생성 로직**을 추정하여 설계에 반영. |
| **자동 접근 제공**      | 1. **시작 스크립트 개발:** Pod의 `ENTRYPOINT` 또는 Sidecar 컨테이너를 사용하여, Pod 부팅 시 사용자로부터 전달받은 **SSH 공개 키를 주입**하고, 생성된 **Web Proxy URL**과 **SSH 접속 정보**를 중앙 DB에 기록하는 스크립트를 구현합니다.                                                                                                            | **`runpod-workers`** 분석: 컨테이너 **시작/종료 시점**에 실행되는 스크립트 및 환경 구성 방식 파악.                            |
|                   |                                                                                                                                                                                                                                                                                |                                                                                                 |

#### C. 토크노믹스 결제 및 지갑 관리 시스템

|**기능**|**상세 개발 과정**|**참고 코드 분석**|
|---|---|---|
|**실시간 정산 및 모니터링**|1. **자체 모니터링 에이전트 개발:** Go 또는 Python을 사용하여 Pod 내에서 **시작(Running)** 및 **중지(Stopped/Terminated)** 이벤트를 감지하고 **GPU 사용량 데이터**를 중앙 정산 서버로 **실시간 전송**하는 에이전트 구현. 2. **정산 로직 구현:** 중앙 서버에서 초 단위 사용 시간 ($\Delta t$)과 GPU 타입(Rate)을 매칭하여 정확한 요금을 계산하는 **Off-Chain 정산 모듈** 개발.|**`worker-comfyui`** 분석: 워커 컨테이너의 라이프사이클과 상태 변화를 파악하여 모니터링 에이전트 설계.|
|**온체인 결제 게이트웨이**|1. **스마트 컨트랙트 개발:** 사용자 지갑에서 GPU 공급자 지갑으로 토큰을 전송하는 핵심 결제 함수(`Payment(userAddress, providerAddress, durationInSeconds, gpuType)`)를 포함하는 **솔리디티(Solidity) 컨트랙트** 개발 및 테스트넷 배포. 2. **백엔드 트랜잭션 API:** 정산 모듈이 계산한 최종 결과를 입력받아 **Web3 라이브러리**를 통해 **자동으로 컨트랙트 함수를 호출**하고 서명하여 블록체인에 트랜잭션을 제출하는 API를 개발합니다.|-|
|**핫 월렛 관리**|1. **키 관리 시스템 구축:** 핫 월렛의 프라이빗 키를 **HSM** 또는 **Vault**와 같은 전용 키 관리 서비스에 안전하게 저장하고, 트랜잭션 서명 시에만 사용하도록 접근을 통제합니다. 2. **잔액 및 보안 모니터링:** 핫 월렛의 잔액을 실시간으로 감시하고, **최소 운영 잔액** 이하로 떨어지거나 **비정상적인 인출** 발생 시 즉시 운영자에게 경고(Alert)를 발송하는 시스템을 구축합니다.|-|

## 개발 핵심 - runpod 코드 분석 및 재조립 / 토크노믹스 설계 / 온체인 연결 로직
